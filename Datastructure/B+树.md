# B+树

## 1. 问题

### 1.1 mysql索引为什么选择B+树

b站视频：

https://www.bilibili.com/video/BV1Zu4y1z7NV/?spm_id_from=333.337.search-card.all.click&vd_source=c6838f09fbfc9766e04f0c65ca196c42

自己的归纳：

+ 存放相同的数据，B+树的高度比跳表少。意味着更少的磁盘IO。
+ 跳表的写入性能比B+树好。但是它的读性能比B+树差不少。

MySQL选择B+树作为索引结构而不是跳表的主要原因有以下几点：

1. **磁盘读写友好**：B+树是为磁盘或其他直接访问辅助设备设计的，能够减少磁盘I/O操作次数。数据库中的索引一般是存储在磁盘上的，当数据量大时，不能把整个索引全部加载到内存中，只能逐一加载每一个磁盘页（对应索引树的节点）。B+树的设计能够最大化磁盘页的利用率，使得每次磁盘I/O都能加载尽可能多的有效信息。相比之下，跳表在这方面的优化不如B+树。
2. **查询效率**：对于范围查询，B+树只需找到范围的最小值，然后通过叶子节点的链表顺序遍历即可，效率非常高。而跳表虽然也能进行范围查询，但效率不如B+树。
3. **节点空间利用率**：B+树的非叶子节点不保存数据记录的指针，只保存关键字和子节点的指针，这使得B+树的非叶子节点相对更小，能够容纳更多的关键字，从而减少树的深度。而跳表的每个节点都保存了数据记录的指针，空间利用率相对较低。
4. **稳定性与平衡性**：B+树是一种平衡树，插入和删除操作不会破坏树的平衡性，因此查询性能稳定。而跳表虽然也能通过随机化算法保持相对平衡，但在某些极端情况下可能会导致性能下降。
5. **数据库特性匹配**：B+树作为数据库索引结构已经经过了长时间的发展和优化，与数据库的许多特性（如事务、并发控制等）能够很好地匹配。而跳表在这些方面的应用相对较少。
6. **历史原因和技术惯性**：B树和B+树在数据库领域的应用已经有很长的历史，许多数据库系统都是基于这些数据结构构建的。选择B+树作为索引结构也是出于技术惯性和兼容性的考虑。

综上所述，MySQL选择B+树作为索引结构主要是因为它在磁盘读写、查询效率、空间利用率、稳定性与平衡性等方面具有明显优势，并且与数据库的特性能够很好地匹配。

### 1.2 为什么redis用跳表不用B+树

Redis选择使用跳表而不是B+树的主要原因有以下几点：

1. 内存使用：Redis是一种内存数据库，数据主要存储在内存中。跳表作为一种数据结构，更适合在内存中实现和操作。而B+树的设计初衷是为了减少磁盘I/O操作，将数据划分为多个磁盘页，并通过树结构进行索引。因此，在内存环境下，跳表相对于B+树来说更为简单和高效。
2. 操作复杂度：跳表和B+树在操作复杂度上相似，都能在对数时间复杂度内完成查找、插入和删除等操作。然而，跳表的实现相对简单，不需要像B+树那样维护复杂的平衡性。
3. 灵活性：跳表具有更高的灵活性。它可以通过改变索引构建策略来平衡执行效率和内存消耗。此外，跳表还支持动态扩展和缩减，更容易适应不同的数据规模和需求。
4. 代码实现和维护：跳表的代码实现相对简单，更容易理解和维护。相比之下，B+树的代码实现较为复杂，涉及更多的细节和平衡性维护。

需要注意的是，虽然Redis选择了跳表作为其主要数据结构之一，但这并不意味着B+树在所有场景下都不如跳表。实际上，在需要处理大量磁盘I/O操作的场景下（如传统的关系型数据库），B+树仍然是一种非常有效和高效的数据结构。因此，在选择数据结构时，需要根据具体的应用场景和需求进行权衡。

## 2. 外部资料

b站视频：

https://www.bilibili.com/video/BV15V411p7pi/?spm_id_from=333.337.search-card.all.click&vd_source=c6838f09fbfc9766e04f0c65ca196c42

https://www.bilibili.com/video/BV1Zu4y1z7NV/?spm_id_from=333.337.search-card.all.click&vd_source=c6838f09fbfc9766e04f0c65ca196c42

文章：

https://ivanzz1001.github.io/records/post/data-structure/2018/06/16/ds-bplustree

## 3. 基础知识

### 3.1 基本知识

B+树是B树的一个升级版，也属于平衡多路查找树，其大体结构与B树相同，包含根节点、内部节点和叶子节点。不过，B+树在设计和使用上有一些与B树不同的特点，主要如下：

1. **数据存放**：B+树的非叶子节点不保存关键字记录的指针，只进行数据索引。而B+树的叶子节点保存了父节点的所有关键字记录的指针，所有数据地址必须要到叶子节点才能获取到。所以每次数据查询的次数都一样，这使得查询速度更加稳定。
2. **空间利用率**：B+树的设计使得其更充分地利用了节点的空间，让查询速度更加稳定，其速度完全接近于二分法查找。同时，由于B+树叶子节点之间是相互链接的，因此它对整棵树的遍历只需要一次线性遍历叶子节点即可。这有利于数据库做全表扫描。
3. **查找效率**：B+树的叶子节点的关键字从小到大有序排列，左边结尾数据都会保存右边节点开始数据的指针。这使得B+树在进行范围查找和搜索时更加高效。

总结来说，B+树通过优化数据存放方式、提高空间利用率和查找效率等方面，实现了比B树更加稳定和高效的查询性能。这使得B+树在数据库和文件系统等需要大量数据存储和查询的场景中得到了广泛应用。